---
title: "GAN"
date: 2021-06-10 08:26:28 -0400
categories: Deep Learning
---

### GAN(Generative Adversarial Nets)

<br>
<br>
<br>
<br>
<br>
<br>

## 0. Introduction   

* In 2014, Ian J. Goodfellow published a new model called Generative Adversarial Nets (GANs).



* You read the paper by below link.

  [Generative Adversarial Nets](https://papers.nips.cc/paper/2014/file/5ca3e9b122f61f8f06494c97b1afccf3-Paper.pdf)
  
  
* You would be easily aware that 'Nets' is well-known 'Network' but the exact meaning of 'Adversarial' or 'Generative' is a little bit difficult.

  
* We will review what 'GAN' is in this post.
<br>
<br>
<br>
<br>
<br>
<br>

## 1. Background

### 1.1. Generative Model   

* GAN is able to generate a data that **is likely to** exist but actually not exist.


* Below image is from the paper of Ian Goodfellow.


* The blue ones are real image and the red ones are generated by GAN.  They seem to be real one.

<br>
<br>

<p align="left">
  <img src="/assets/GAN/pic_00.png">
</p>

<br>
<br>
<br>
<br>
<br>
<br>

### 1.2. Probability Distribution

* I really hate math., but we need to know the basic background of math.(Especially, probability) because the paper is full of math.

<br>
<br>

* First, let's dive into 'Probability Distribution'

<br>
<br>

* Probability Distribution is a function that represents the probability that a random variable has a certain value.
  
  If a random variable X is the number of possible outcomes when a dice is rolled, P(X=1) is 1/6, and all P(X=1~6) have the same value (1/6).  

<br>
<br>

* There are 2 kind of random distributions, Discrete Probability Distribution & Continuous Probability Distribution.

<br>
<br>
<br>
<br>
   

#### 1.2.1. Discrete Probability Distribution

* Discrete probability distribution is a case in which the number of random variables X can be counted.

<br>

* The dice example at the previous example belongs to the discrete probability distribution.

<br>
<br>

<p align="left">
  <img src="/assets/GAN/pic_01.png">
</p>

<br>
<br>
<br>
<br>

#### 1.2.2. Continuous Probability Distribution

* Continuous Probability Distribution is a probability distribution when the number of random variables X cannot be accurately counted.

<br>

* Since the number of random variables X cannot be counted accurately, in this case, the probability distribution is expressed using the probability density function.

<br>

* Examples of this might be things like height or running performance.

<br>

* Normal distribution can also be called continuous probability distribution.

<p align="left">
  <img src="/assets/GAN/pic_02.png">
</p>

<br>
<br>
<br>

* In reality, the distribution of many data can be approximated as a normal distribution, and this fact is very useful for expressing and utilizing actual data.

<br>

* One of the example of a normal distribution in the real world is IQ.

<br>

<p align="left">
  <img src="/assets/GAN/pic_03.png">
</p>

<br>
<br>
<br>
<br>

#### 1.2.3. Probability Distribution of Image

* The term 'Probability Distribution for an Image' may seem a bit cryptic.

<br>

* If you think about it, an image can also be expressed as a point in a multidimensional feature space. ( High-dimensional Vector or Matrix )

<br>

* In other words, a model that approximates this probability distribution by expressing the image data as a probability distribution can be learned using GAN.

<br>

* 'What probability distribution is there in image data?'
  * Human faces have **statistical averages**.
  * For example, there could be values such as the relative positions of the eyes, nose, mouth, etc.
  * This means that these numbers can be expressed as probability distributions.

<br>
  
* In Image, various features can each be a random variable, which means a distribution.

<br>

* For example, below one represents 'Multivariate Probability Distribution'.

<p align="left">
  <img src="/assets/GAN/pic_04.png">
</p>

<br>
<br>
<br>
<br>
<br>
<br>

## 2. Generative Model

<br>
<br>   

### 2.1.  Generative Model vs Discriminative Model

* Machine learning or deep learning models before GAN learn patterns from data, the model outputs a specific value based on the learning result for new data and discriminates it based on value from model output.

<br>

* In other words, a discriminative model is to learn a **specific decision boundary**.

<br>

* On the other hand, a generative model is a model that learns probability distribution from sample data and creates a probability distribution similar to the learned probability distribution although it does not actually exist.

<br>

* This means that generative models learn **statistical means** and generate similar probability distributions.

<p align="left">
  <img src="/assets/GAN/pic_05.png">
</p>

<br>
<br>
<br>

### 2.2.  Purpose of Generative Model

* As mentioned before, the purpose of generative models is to generate a model G that approximates the probability distribution.

<br>

* The generative model is trained through the following process and learned to approximate the probability distribution of the original data.

<br>

* If G is well trained, it will be possible to easily generate data with similar statistical averages to the original data.

<br>

* A more detailed explanation of this graph will be given later.

<p align="left">
  <img src="/assets/GAN/pic_06.png">
</p>

<br>
<br>
<br>
<br>
<br>
<br>

## 3. GAN(Generative Adversarial Nets)

<br>
<br>

* GAN is a generative model using two networks, a generator and a discriminator.

<br>

* The figure below is taken from Tensorflow's GAN page and shows the basic structure of GAN.

<br>

* There are two main models, a generator and a discriminator.

<br>

* Generator learns the original data probability distribution and is trained to generate data similar to the original probability distribution and the Discriminator learns to distinguish whether the data generated by the generator is real or fake.

<br>

* The ultimate purpose of these two models is to **improve the performance of the generator** by conducting competitive learning.

<br>

<p align="left">
  <img src="/assets/GAN/pic_05-1.png">
</p>
   
<br>
<br>

* During the training process, the generator will gradually become better at creating realistic images, and the discriminator will gradually become better at distinguishing between real and fake. This process reaches equilibrium when the discriminator can no longer distinguish the real image from the fake image generated by generator.

<br>

<p align="left">
  <img src="/assets/GAN/pic_05-2.png">
</p>

<br>
<br>
<br>

* The role of the discriminator is to help the generator G learn well, and the final goal to get is the generator (G).

<br>

* The following formula is from Ian's paper and explains the operation of GAN well.

<br>
<br>

<p align="left">
  <img src="/assets/GAN/pic_07.png">
</p>

<br>

* Let's understand the meaning of the above formulas one by one.

<br>

<p align="left">
  <img src="/assets/GAN/pic_08.png">
</p>

<br>

* #1 : The whole function V consists of D and G.

<br>

* #2: D learns to the direction of maximizing the entire equation V.

<br>

* #3: Conversely, G learns to the direction of minimizing the entire equation V.

<br>
<br>
<br>

* First, let's look at the terms containing D.

<br>

<p align="left">
  <img src="/assets/GAN/pic_09.png">
</p>

<br>   

* #1 : Take one data(x) from the probability distribution P.

<br>

* #2: Taking the log of the result of putting the extracted data(x) into the function D,

<br>

* #3 : Calculate expected value(E). You may consider that expected value means the average value.

<br>
<br>
<br>

* Let's look at terms that contain G.

<br>

<p align="left">
  <img src="/assets/GAN/pic_10.png">
</p>

<br>

* #1: Probability distribution z is a latent vector and can be also noise vector. Pick one z from the latent vector.

<br>

* #2 : Put z into G, and take the log after subtracting the result of putting the value generated by G into D from 1.

<br>

* #3 : Take the log and find the overall expected value (average).

<br>
<br>
<br>

* In the above formula, G(z) is a generator, which creates a new data instance from latent vector z.

<br>

* D(x) returns the probability that the probability distribution x is real or fake. ( Real : 1 , Fake : 0 )

<br>
<br>

* It can be seen that V is optimized by D and G and as a result, G can generate plausible data, according to paper.

<br>
<br>
<br>

### 3.1.  Calculation of Expected Values

<br>

* E (expected value) is calculated in the above formula but the simplest way to implement it in the actual code is to simply obtain the values for all data and then find the **average**.

<br>

* Usually, E (expected value) is used when you want to find the average value when dealing with a lot of data.

<br>
<br>

<p align="left">
  <img src="/assets/GAN/pic_11.png">
</p>

* The above expression means to calculate the expected value of logD(x) by extracting x from the original data distribution.

<br>
<br>
<br>

<p align="left">
  <img src="/assets/GAN/pic_12.png">
</p>

<br>

* The above formula means that the expected value of log(1 - D(G(z))) is calculated by taking z from the latent vector.

<br>

* In the actual code, you can calculate all data in a loop.

<br>
<br>
<br>
<br>

### 3.2.  Train Process

<br>
<br>

* The goal of learning is described by the following formula.

<br>

<p align="left">
  <img src="/assets/GAN/pic_13.png">
</p>

<br>
<br>

* When G is finished learning, D cannot distinguish the real / fake generated by G, so the probability is returned 1/2.

<br>

* Please refer to the proof of the above formula as it is a very complex formula in Paper.

<br>
<br>

* Let's look at the learning process again with the picture showed earlier.
<br>

<p align="left">
  <img src="/assets/GAN/pic_14.png">
</p>

<br>

* The black probability distribution indicates the probability distribution of the original data, the green indicates the probability distribution generated by the generator, and the blue indicates the return value of the discriminator.

<br>

* As learning progresses from left to right, it indicates that the probability distribution generated by the generative model follows the original probability distribution, and the discriminator converges to 1/2.

<br>
<br>
<br>
<br>

### 3.3.  Learning Algorithm of GAN

<br>
<br>

* The pseudo code below is the code shown in the paper.

<br>

<p align="left">
  <img src="/assets/GAN/pic_16.png">
</p>

<br>
<br>

* Train D (Discriminator) first.

<br>

* Extracts m samples from the latent vector and extracts m samples from the original data.

<br>

* D proceeds training to the direction of maximizing the equation while observing the gradient.

<br>

* Repeat training D k times in the same way as above.

<br>

* Next, train G (Generator). Extract m samples from the latent vector.

<br>

* Training proceeds to the direction of minimizing the formula value at the bottom.

<br>
<br>
<br>

* In this post, I briefly reviewed the GAN paper.

<br>

* In the next post, I will learn about GAN by running the actual code.
